<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° - ì½”ë“œë¸”ë£¨</title>

<!-- Custom fonts for this template-->
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

<!-- Custom styles for this template-->
<link href="css/sb-admin-2.min.css" rel="stylesheet">
<!-- Custom styles for codeBlue -->
<link href="css/codeBlue.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body style="background: #ebebeb; height: 94vh">
 
	<!-- Topbar -->
	<div id="topBar"></div>
	<!-- End of Topbar -->

		<!-- Begin Page Content -->
		<div class="container" style="height: 100%" align="center">  
			<div class="p-5 m-5 text-left" style="width: 50%"> 
				<p class="text-center">
					<a href="/">
						<img src="/img/codeBlueIcon.png" width="50px"><br>
						<img class="mb-3" src="/img/codeBlue.png" width="100px">
					</a> 
				</p>
				<!-- email Form begin -->
				<div class="card shadow px-2 mx-5"> 
					<form class="card-body pb-0">
						<small>
							ë¹„ë°€ë²ˆí˜¸ê°€ ê¸°ì–µì´ ì•ˆë‚˜ì‹œë‚˜ìš”? ì´ë©”ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ì¸ì¦ ì½”ë“œë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤! ì¸ì¦ì½”ë“œë¡œ ì´ë©”ì¼ì„ ì¸ì¦í•˜ê³  ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒˆë¡œ ì„¤ì •í•´ë³´ì„¸ìš”.
						</small>
					  <div class="form-group">
					    <label class="text-dark font-weight-bold mt-3" for="userId">ì´ë©”ì¼</label>
					    <input type="email" class="form-control form-control-sm" id="id" placeholder="E-Mail@example.com"> 
					  </div>  
					  <button type="button" class="btn btn-block btn-primary mb-2" id="getCode">ì¸ì¦ ë©”ì¼ ë°›ê¸°</button> 
					</form> 
					
					<!-- ì…ë ¥ í´ë¦­ì‹œ ì¸ì¦ì½”ë“œ ì…ë ¥ë€ ì¶œë ¥ -->
					  <b class="text-sm card mt-1 mx-3 p-3 text-center text-primary shadow" id="notice" style="display:none">ì¸ì¦ ë©”ì¼ì´ ì „ì†¡ ë˜ì—ˆìŠµë‹ˆë‹¤!</b>
					  <form class="was-validated card-body px-2 py-2" > 
						  <div id="codeForm" style="display:none">	  
						  	<div class="form-group">
						    	<label class="text-dark font-weight-bold mt-1" for="code">ì¸ì¦ì½”ë“œ</label>
						    	<input type="text" class="form-control" id="code" placeholder="ì¸ì¦ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" required> 
						    	<div class="invalid-feedback">ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ†</div> 
						  	</div> 
						  	<button type="button" id="confirmCode" class="btn btn-block btn-outline-primary mb-1">í™•ì¸</button>  
							<a href="#" id="resend" class="small text-center">ë©”ì¼ì„ ëª» ë°›ìœ¼ì…¨ë‚˜ìš”? ë‹¤ì‹œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤!</a> 
						  </div>
					  </form> 
				</div> <!-- email Form end -->
				
				<!-- reset Form begin -->
				<div class="card shadow mt-2 pt-3 px-2 mx-5" id="restForm" style="display:none"> 
					<b class="card border-success text-success p-2 mx-3 text-center mb-0">ì¸ì¦ì´ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ ì£¼ì„¸ìš”.</b>
					<form class="was-validated card-body" action="/resetPassword" method="post">
					  <div class="form-group mb-1">
					    <label class="text-dark font-weight-bold" for="pw">ë¹„ë°€ë²ˆí˜¸</label>
					    <input type="password" class="form-control form-control-sm" id="pw" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
					    <div class="valid-feedback">ì¢‹ì•„ìš”.</div>
					    <div class="invalid-feedback">ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
					  </div>
					  <div class="form-group">
					    <label class="text-dark font-weight-bold" for="pw2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
					    <input type="password" class="form-control form-control-sm" id="pw2" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
					    <div class="valid-feedback">ì¢‹ì•„ìš”.</div>
					    <div class="invalid-feedback">ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
					  </div> 
					  <button type="button" id="reset" class="btn btn-block btn-outline-primary">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
				  	</form>
				</div>
				<!-- reset Form end -->
				
			</div> 			
		</div> 
		<!-- Page Content End --> 
		 


	<!-- Bootstrap core JavaScript-->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

	<!-- Custom scripts for all pages-->
	<script src="js/sb-admin-2.min.js"></script>
	
	<!-- CodeBlue scripts -->
  	<script src="js/codeBlueUser.js"></script>
  	
</body>
<script> 
	
	$("#getCode").click(function(){
		$.ajax({
			url : "/rest/verifyUserForReset",
			method : "post",
			data : {"userId" : $("#id").val()},
			success : function(json){
				console.log(json);
				if(json == "noSuchUser"){
					alert("í•´ë‹¹ ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ëŠ” ìœ ì € ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤!");
					return;
				}
				console.log("ë©”ì¼ ì „ì†¡ ì™„ë£Œ!") 
				$("#userId").prop("readonly", true);
				$("#getCode").prop("disabled", true);
				
				$("#notice").fadeIn(300); 
				setTimeout(function() {
					$("#codeForm").slideDown(500); 
				}, 300); 
				
			}
		})
	})
	
	$("#resend").click(function(){
		console.log("ì…ë ¥ì™„ë£Œ ë©”ì¼ì „ì†¡ ì‹œì‘.");
		$.ajax({
			url:"/rest/sendEmailToConfirm",
			data:{ "userId" : $("#id").val() },
			method:"post", 
			success:function(){
				console.log("ë©”ì¼ ì „ì†¡ ì™„ë£Œ!")
			}
	
		})
		 
	})
	
	$("#confirmCode").click(function(){
		console.log("ì½”ë“œ ê²€ì‚¬");
	 	$.ajax({
	 		url:"/rest/verifyCodeForRest",
			method:"post", 
			async : "true",
			data : {"code":$("#code").val()},
			success:function(json){
				console.log(json);
				if(json == false){
					alert("ì½”ë“œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•˜ì—¬ ì£¼ì„¸ìš”. :( ")
					return;
				}
				$("#code").prop("disabled", true);
				$("#confirmCode").prop("disabled", true);
				$('#resend').css("display", "none");  
				
				setTimeout(function() {
					$("#restForm").fadeIn();
				}, 300); 		
				
				
			},
			fail:function(){
				alert("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒ í–ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•˜ì—¬ ì£¼ì„¸ìš” ğŸ˜¥");
			}
		})
	})  
	
	$("#reset").click(function(){
		console.log("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½!");
		if($("#pw").val() != $("#pw2").val()){
			alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!!");
			return;
		}
		
		$.ajax({
			url : "/rest/resetPassword",
			method : "post",
			data :{ "userId" : $("#id").val(),
					"userPw" : $("#pw").val() }, 
			success : function(json){
				console.log("ì‹¤í–‰");
				location.href="/login";
			}                                                                                                                                                                                                                                          
		})
	})
	
</script>
</html>