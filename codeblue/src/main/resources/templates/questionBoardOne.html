<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>ì§ˆë¬¸ - ì½”ë“œë¸”ë£¨</title>

<!-- Custom fonts for this template-->
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
	type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.css"
	rel="stylesheet">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.js"></script>

<!-- Custom styles for this template-->
<link href="css/sb-admin-2.min.css" rel="stylesheet">
<!-- Custom styles for codeBlue -->
<link href="css/codeBlue.css" rel="stylesheet">
</head>

<body id="page-top">

	<!-- Topbar -->
	<div id="topBar"></div>
	<!-- End of Topbar -->

	<div class='content'>
		<!-- Begin Page Content -->
		<div class="container">
			<div class="row">
			
				<!-- Side Bar -->
				<div class="col-sm-1 p-0 " style="border-right: 1px solid #d9d9d9;">
					<div id="leftSideBar"></div>
				</div>
				<!-- Side Bar End -->

				<!-- Page Content -->
				<div class="col-sm-11 pl-4">
					<!-- Page Heading -->
					<div class="d-sm-flex align-items-center justify-content-between"
						style="margin-top: 80px">
						<h1 class="text-gray-800 font-weight-bold h3" id="title"></h1>
					</div>
					<!-- page Heading End -->
					<small id="datetime">ë“±ë¡ì¼ </small>
					<hr>
					<div class="row">
						<div class='col-sm-9' style="width: 100%">
							<div id="tableBody" class='text-dark table-borderless text-lg' style="word-break:break-all;"></div><!-- ì§ˆë¬¸ ë‚´ìš© ì¶œë ¥  -->
							<div class="mt-4" id="tagList" style="word-break:break-all;"></div>
							<div class="d-flex justify-content-between mt-1">
								<div>
									<a id="commentBtn" class="btn hov-p px-1"><i class='far fa-comment-dots mx-1'></i></a>
									<a id="reportBtn" class='px-1 text-danger btn hov-p'>ì‹ ê³ </a>
									<a id="goodBtn" class="px-1 text-primary btn hov-p">ì¶”ì²œ</a>
								</div>
								<div class="pr-2 row">
									<div id="modify"></div>
									<div class="card bg-gray-200 text-dark d-flex p-1" id="questionUserName"></div>
								</div>
							</div>

							<div class="card p-3 bg-gray-100 border-0"style="display: none;" id="questionComment">
								<form method="post">
									<div>
										<textarea id="questionCommentContent" class="form-control form-control-sm" maxlength="1000"
											placeholder="ê°œì¸ì •ë³´ë¥¼ ê³µìœ  ë° ìš”ì²­í•˜ê±°ë‚˜, ëª…ì˜ˆ í›¼ì†, ë¬´ë‹¨ ê´‘ê³ , ë¶ˆë²• ì •ë³´ ìœ í¬ì‹œ ëª¨ë‹ˆí„°ë§ í›„ ì‚­ì œë  ìˆ˜ ìˆìœ¼ë©°, ì´ì— ëŒ€í•œ ë¯¼í˜•ì‚¬ìƒ ì±…ì„ì€ ê²Œì‹œìì—ê²Œ ìˆìŠµë‹ˆë‹¤."></textarea>
									</div>
									<div>
										<div class="text-right m-1">
											<button type="button" id="questionCommentBtn" class="btn btn-sm btn-primary text-right px-3">ë“±ë¡</button>
										</div>
									</div>
								</form>
								<div id="questionCommentList">
								</div>
							</div>
							<h1 class="h5 text-dark mt-3 mb-0 font-weight-bold" id="answerCount"></h1>
							<hr class="mt-2"> 
							<div id="answerList"  class='table table-hover table-sm'>
								<table id="bodyTable" class="text-dark"></table>
							</div>
							
							<!-- ë‹µë³€ ì…ë ¥ë€ -->
							<p class='text-gray-900 small text-right mb-1 '>ë„ì›€ì„ ì¤„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì„ ì•Œê³  ê³„ì‹ ê°€ìš”? ì§ˆë¬¸ì— ë§í¬ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”!</p>
							<div id="summernote" class="mb-3"></div>
							<button class='btn btn-sm btn-primary m-1 px-4' id="addAnswerBtn">ë‹µë³€ê²Œì‹œ</button>
							
						</div>
						
						<!-- Page rigth side bar -->
						<div class="col-sm-3 mb-4" id="rightSideBar"></div>
						<!-- rigth side bar end -->
						
					</div>
				</div>
			</div>
		</div>

		<!-- Footer -->
		<div id="footer"></div>
		<!-- End of Footer -->

	</div>
<!-- ETC -->
  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded bg-primary" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <div class="modal-body">ë¡œê·¸ì•„ì›ƒ í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ì•„ë˜ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”!</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">ì·¨ì†Œ</button>
          <a class="btn btn-primary" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
      </div>
    </div>
  </div>

	<!-- Bootstrap core JavaScript-->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

	<!-- Custom scripts for all pages-->
	<script src="js/sb-admin-2.min.js"></script>

	<!-- summer note scripts -->
	<script src="js/summernote/summernote-bs4.min.js"></script>
	<script src="js/summernote/summernote-ko-KR.js"></script>
	<script src="js/summernote/summernote.min.js"></script>

	<!-- CodeBlue scripts -->
	<script src="js/codeBlueUser.js"></script>
</body>
<script>

//í˜„ì¬ ë¡œê·¸ì¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
var userId = undefined;
$.ajax({
	url : "/rest/getLoginUser",
	method : "get",
	async : "false",
	success : function(json){
		console.log(json);
		userId = json.userId;
		console.log("userId: ",userId);
	}
});
$("#modifyBtn").hide();

//ì§ˆë¬¸ ë‹µë³€ ì…ë ¥ì°½
$('#summernote').summernote({
	  toolbar: [
			['style', ['style']],
			['style', ['bold', 'italic', 'underline', 'clear']],
			['font', ['strikethrough', 'superscript', 'subscript']],
			['fontsize', ['fontsize']],
			['color', ['color']],
			['para', ['ul', 'ol', 'paragraph']],
			['height', ['height']],
			['fontsize', ['8','10','10','10','10']],
			['para', ['ul', 'ol', 'paragraph']],
			['table', ['table']],
			['insert', ['link', 'picture', 'video']]
		],
	lang : 'ko-KR',
	placeholder: 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
	tabsize: 4,
	height: 150
});

//ì§ˆë¬¸ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
$.ajax({
	url : "/rest/questionBoardOne",
	method : "post",
	data : {"questionId" : getParam("questionId")},
	success: function(json) {
		console.log(json);
		$("#title").append(json.questionTitle);
		$("#datetime").append(json.questionDatetime);
		$("#commentBtn").append(json.commentCount);
		$("#tableBody").append(json.questionContent);
		$("#questionUserName").append('<a href="/userOne?userId='+json.user.userId+'">'+json.user.userName+'</a>');
		//ì§ˆë¬¸ ë‹µë³€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
		if(json.questionTags != null && json.questionTags != "" ){
			console.log("íƒœê·¸ ìˆìŒ!")
			console.log(json.questionTags);
			let tags = json.questionTags;
			tags = tags.split("#");
			console.log(tags);
			let html = "";
			for(let i=1;i<tags.length;i++){
				console.log(i);
				html +='<a class="text-primary mr-2 p-0 px-1 btn btn-light alert-primary" href="#">#'+tags[i]+'</a>';
			}
			$("#tagList").append(html);
		}
		
		console.log(userId, json.user.userId);
		if(userId == json.user.userId){
			$("#modify").append("<a id='modifyBtn' class='px-1 btn hov-p text-dark mx-1' href='/modifyQuestion?questionId="+json.questionId+"'>ìˆ˜ì •</a>");
			console.log("ìˆ˜ì •ê°€ëŠ¥");
		}else{
			console.log("ìˆ˜ì •ë¶ˆê°€");
		}
		getAnswerList();
	}
});

//ì§ˆë¬¸ ëŒ“ê¸€ì¶œë ¥
$("#commentBtn").click(function(){
	if($("#questionComment").css("display") == "none"){   
        $('#questionComment').slideDown(300);
    } else {  
        $('#questionComment').slideUp(300);
    }  
	appendQuestionComment();
});
//ì§ˆë¬¸ ëŒ“ê¸€ ì¶”ê°€í•˜ê¸°
$("#questionCommentBtn").click(function(){
	if(userId == undefined){
		alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
		return;
	}
	$.ajax({
		url : "/rest/questionCommentAdd",
		method : "post",
		data : { "questionBoard.questionId" : getParam("questionId"),
				 "questionCommentContent": $("#questionCommentContent").val(),
			 	 "user.userId" : userId},
		success:function(json){
			$("#commentBtn").empty();
			$("#commentBtn").append("<i class='far fa-comment-dots mx-1'></i>"+json);
			appendQuestionComment();
			//console.log("questionCommentAdd success");
		}
	})
});


// ì§ˆë¬¸ ë‹µë³€ ì¶”ê°€í•˜ê¸°
$("#addAnswerBtn").click(function(){
	if(userId == undefined){
		alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
		return;
	}
	//alert("ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.");
	$.ajax({
		url : "/rest/answerAdd",
		method : "post",
		data : {"questionBoard.questionId" : getParam("questionId"),
				"user.userId" : userId,
				"answerContent" : $("#summernote").summernote('code')},
		success : function(json){
			console.log(json)
			getAnswerList();
		}
	})
});

//ì§ˆë¬¸ ê²Œì‹œê¸€ ì¶”ì²œê¸°ëŠ¥
$("#goodBtn").click(function(){
	console.log(userId);
	if(userId == undefined){
		alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
		return;
	}
	$.ajax({
		url : "/rest/questionVote",
		method :"post",
		data : {"user.userId":userId,
				"questionBoard.questionId": getParam("questionId")
			},
		success : function(json){
			console.log("ì¶”ì²œ",json);
			console.log("ì¶”ì²œì¶”ì²œ");
			if(json == 1){
				alert("ì¶”ì²œğŸ‘");	
			}else{
				alert("ì´ë¯¸ ì¶”ì²œí•˜ì…¨ìŠµë‹ˆë‹¤.")	
			}
		}
	})
})


//ë‹µë³€ ê²Œì‹œê¸€ ì¶”ì²œ
function answerGoodBtn(answerId){
	if(userId == undefined){
		alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
		return;
	}
	
	$.ajax({
		url : "/rest/answerVote",
		method : "post",
		data : {"user.userId": userId,
				"answer.answerId" : answerId},
		success : function(json){
			console.log(json);
			console.log("ë‹µê¸€ì¶”ì²œ");
			if(json == 1){
				alert("ì¶”ì²œğŸ‘");	
			}else{
				alert("ì´ë¯¸ ì¶”ì²œí•˜ì…¨ìŠµë‹ˆë‹¤.")	
			}
		}
	})
}

//ì§ˆë¬¸ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
function appendQuestionComment(){
	$.ajax({
		url:"/rest/getQuestionCommentList",
		method:"POST",
		data:{"questionId" : getParam("questionId")},
		success: function(json){
			console.log(json);
			$("#questionCommentList").empty();
			$(json).each(function(index,item){
				html =	"<p class='text-dark mb-1 small'>"+item.questionCommentContent+"</p>"+
						"<p class='text-right small  mb-1'>"+ item.questionCommentDatetime+" <a href='/userOne?userId="+item.user.userId+"'>"+item.user.userName+"</a></p><hr class='my-1'>";
				$("#questionCommentList").append(html);
			})
		}
	});
}

//ì§ˆë¬¸ ë‹µë³€ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
function getAnswerList(){
	$.ajax({
		url : "/rest/getAnswerList",
		method : "post",
		data : {"questionId" : getParam("questionId")},
		success : function(json){
			console.log(json);
			$("#answerCount").text(json.length+"ê°œì˜ ë‹µë³€");
			$("#answerList").empty();
			$(json).each(function(index, item){
				//ì§ˆë¬¸ì˜ ë‹µë³€ ì¶œë ¥
				let answerhtml = "<div class='text-dark text-lg px-1'>"+item.answerContent+"</div>";
				//ë²„íŠ¼ ìƒì„±
				answerhtml += "<div class='d-flex justify-content-between small mt-5'><div class='px-2'><a id='answerCommentBtn' onclick='openComment("+item.answerId+",true)'>";
				answerhtml += "<i id='answerCommentTotal"+item.answerId+"' class='far fa-comment-dots mx-1'></i></a>";
				answerhtml += "<a class='px-1 py-0 text-sm text-danger' href='' onclick=window.open('/answerReport?answerId="+item.answerId+"','ë‹µë³€ì‹ ê³ í•˜ê¸°','width=600,top=200,left=600,height=410');return false;>ì‹ ê³ </a>"
				answerhtml += "<a class='px-1 py-0 text-sm text-primary' href='' onclick='answerGoodBtn("+item.answerId+")'>ì¶”ì²œ</a></div>";
				//ì§ˆë¬¸ì˜ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
			 	answerhtml += "<div class='d-felx'><div class='mb-0 mx-2 pr-2'>"+item.answerDatetime+" <a href='/userOne?userId="+item.user.userId+"'>"+item.user.userName+"</a></div></div>";
				answerhtml += "</div><div class='card border-0 bg-light card-body mb-2' style='display: none;' id='answerComment"+item.answerId+"'><div id='answerCommentList"+item.answerId+"'></div>";
				//ì§ˆë¬¸ì˜ ëŒ“ê¸€ ì…ë ¥ì°½ ì¶œë ¥
				answerhtml += "<textarea id='answerCommentContent"+item.answerId+"' class='form-control form-control-sm' maxlength='1000'"+
							  "	placeholder='ê°œì¸ì •ë³´ë¥¼ ê³µìœ  ë° ìš”ì²­í•˜ê±°ë‚˜, ëª…ì˜ˆ í›¼ì†, ë¬´ë‹¨ ê´‘ê³ , ë¶ˆë²• ì •ë³´ ìœ í¬ì‹œ ëª¨ë‹ˆí„°ë§ í›„ ì‚­ì œë  ìˆ˜ ìˆìœ¼ë©°, ì´ì— ëŒ€í•œ ë¯¼í˜•ì‚¬ìƒ ì±…ì„ì€ ê²Œì‹œìì—ê²Œ ìˆìŠµë‹ˆë‹¤.'></textarea>"+
							  "<div class='text-right m-1'><button type='button' id='questionAnswerCommentBtn' onclick='addAnswerComment("+item.answerId+")' class='btn btn-sm btn-primary text-right px-3'>ë“±ë¡</button></div></div>";
							  
				answerhtml += "<hr class='mt-2'>";
				openCommentCount(item.answerId);
				$("#answerList").append(answerhtml);
			})
		}	
	});
}

//ì§ˆë¬¸ ë‹µë³€ ëŒ“ê¸€ ì¶”ê°€
function addAnswerComment(answerId){
	console.log("answerCommentContent",$("#answerCommentContent"+answerId).val());
	$.ajax({
		url:"/rest/answerCommentAdd",
		method:"post",
		data:{"answerCommentContent" : $("#answerCommentContent"+answerId).val(),
			  "user.userId":userId,
			  "answer.answerId":answerId},
		success:function(){
			openComment(answerId, false);
		},
		error : function(){
			alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
		}
	})
}

// ì§ˆë¬¸ ë‹µë³€ì˜ ëŒ“ê¸€ í† íƒˆ ìˆ˜ ì¶œë ¥ (**ê°œì˜ ëŒ“ê¸€ ë³´ê¸°)
function openCommentCount(value){
	//ì§ˆë¬¸ ë‹µë³€ì˜ ëŒ“ê¸€ ë³¸ë‹¤
	$.ajax({
	url : "/rest/getAnswerCommentCount",
	method : "post",
	data : {"answerId" : value},
	success :function(json){
		//ì§ˆë¬¸ ë‹µë³€ ëŒ“ê¸€ ê°œìˆ˜ë³´ê¸°
		$("#answerCommentTotal"+value).empty();
		$("#answerCommentTotal"+value).append(json+"ê°œì˜ ë‹µê¸€ ë³´ê¸°");
		}
	})
}
// ì§ˆë¬¸ ë‹µë³€ì˜ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
function openComment(value, YN){
	if(YN){
		console.log("ëŒ“ê¸€ ì°½ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°")
		if($("#answerComment"+value).css("display") == "none"){   
			$("#answerComment"+value).slideDown("300");
	    } else {  
	    	$("#answerComment"+value).slideUp("300");
	    } 
	}
	//ì§ˆë¬¸ ë‹µë³€ì˜ ëŒ“ê¸€ ë³¸ë‹¤
	$.ajax({
	url : "/rest/getAnswerCommentList",
	method : "post",
	data : {"answerId" : value},
	success :function(json){
		//ì§ˆë¬¸ ë‹µë³€ ëŒ“ê¸€ ê°œìˆ˜ë³´ê¸°
		$("#answerCommentTotal"+value).empty();
		$("#answerCommentTotal"+value).append(json.length+"ê°œì˜ ë‹µê¸€ ë³´ê¸°");
		answerCommentLength = json.length;
		$("#answerCommentHtml").empty();
		$("#answerCommentList"+value).empty();
		console.log("answerComment",json);
		$(json).each(function(index, item){
			
			let answerCommentHtml  = "<p class='text-dark mb-1 small'>"+item.answerCommentContent+"</p>"
				+ "<p class='text-right small  mb-1'>"+ item.answerCommentDatetime+" <a href='/userOne?userId="+item.user.userId+"'>"+item.user.userName+"</a></p><hr class='my-1'>";
				/* alert("#answerCommentList"+value); */
				$("#answerCommentList"+value).append(answerCommentHtml);
			})
		}
	})
}
//ì§ˆë¬¸ ì‹ ê³ ì°½ í´ë¦­
$("#reportBtn").click(function() {
	window.open("/questionReport?questionId="+getParam("questionId")+"","ì§ˆë¬¸ì‹ ê³ í•˜ê¸°","width=600,top=200,left=600, height=410");return false;
});
</script>
</html>